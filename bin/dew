#!/usr/bin/env node
'use strict';
// dependencies
var path = require( 'path' ),
    fs = require( 'fs' ),
    findup = require( 'findup-sync' );
// local vars
var cwd = process.cwd(),
    lib = path.join( path.dirname( fs.realpathSync( __filename ) ), '../lib' ),
    dew = require( lib + '/dew.js' ),
    projectPackage = findup( 'package.json', { cwd: cwd } ),
    inputs;

// helpers
var parseInput = require( lib + '/helpers' ).parseInput;

console.log( path.dirname(require.main.filename) );

if ( process.argv.length < 2 ) {
  console.log( 'specify a file to build' );
} else {
  inputs = Array.prototype.slice
    .call( process.argv, 2 )
    .map( function ( el ){
      return parseInput( el );
    })
    .forEach( function ( input ) {
      var fileName = input.fileName,
          stats, ext;
      if ( projectPackage ) {
        stats = require( projectPackage );
        if ( stats.config && stats.config.dew ) {
          ext = stats.config.dew.ext;
        }
      }
      if ( !ext ) {
        ext = input.extension;
      }
      if ( input.fileName && ext ) {
        dew( fileName, ext );
      } else {
        console.log( 'something went wrong on: ' + fileName );
      }
    });
}
